import React, { useEffect } from 'react'
import { useRefresh } from '../../hooks/useRefresh';
import { useDispatch, useSelector } from 'react-redux';
import { getProfilThunk, getCourseThunk, getBadgesThunk } from '../../redux/user/thunk';
import { StyledContainer } from '../../style/components/StyledContainer';
import { StyledWrapper } from '../../style/components/StyledWrapper';
import { StyledHeading } from '../../style/components/StyledHeading';
import { Card } from '../partials/Card';
import { black, green, magenta, primary, purple, yellow } from '../../style/ColorVariable';
import { NavBarSiswa } from '../partials/NavBarSiswa';
import { LevelBar } from '../partials/LevelBar';

export const DashboardSiswa = () => {

    const dispatch = useDispatch()

    const [token, tokenExp] = useRefresh('siswa');
    const profil = useSelector(state => state.user.profil);
    const course = useSelector(state => state.user.course);
    const badges = useSelector(state => state.user.badges);

    useEffect(() => {

        dispatch(getProfilThunk(token, tokenExp, 'siswa'));
        dispatch(getCourseThunk(token, tokenExp));
        dispatch(getBadgesThunk(token, tokenExp));

    }, [dispatch])

    return (

        <StyledContainer flex="flex">
            <NavBarSiswa />
            <StyledWrapper>
                <StyledHeading backgroundcolor={primary}>
                    Dashboard Siswa
                </StyledHeading>
                <div>
                    {profil !== null &&
                        <div>
                            <div className='m-t-20'>
                                <div>
                                    <h2>Hi there!</h2>
                                </div>
                                <div>
                                    <p>Selamat datang di dashboard, kamu bisa melihat statistik mu dibawah!</p>
                                </div>
                            </div>
                            <div className='flex flex-center-start-rev ava-wrapper p-50-lr m-t-10'>
                                <div className='m-t-10 p-10-all flex-only flex-center flex-column avatar-svg-wrap'>
                                    <div className='avatar-svg-dashboard' dangerouslySetInnerHTML={{ __html: profil.avatarSvg }} />
                                    <h3 className='m-t-10'>{profil.nama_siswa}</h3>
                                </div>
                                <div className='m-t-10 flex flex-column p-20-lr bar-wrap'>
                                    <div className='flex-only flex-center-between-rev p-10-ub level-wrap caveat '>
                                        <h2>
                                            Level {profil.level_siswa}
                                        </h2>
                                        <h2>
                                            Level {profil.level_siswa + 1}
                                        </h2>
                                    </div>
                                    <div >
                                        <div className='bordered bg-w'>
                                            <LevelBar
                                                currentLevel={profil.level_siswa}
                                                pointSiswa={profil.point_siswa}
                                            />
                                        </div>
                                    </div>
                                    <div className='text-center m-t-10 m-b-10'>
                                        <p>Dapatkan Point dan Badges dengan menyelesaikan <strong>Materi</strong> atau <strong>Exercise!</strong></p>
                                    </div>
                                </div>
                            </div>
                            <div className='text-center p-10-all badges-title'>
                                <h1>Stats</h1>
                            </div>
                            <div className='flex flex-wrap flex-center m-t-10 p-20-lr course-wrapper '>
                                <Card
                                    svg='<svg width="100" height="100" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fillRule="evenodd" clipRule="evenodd" d="M59.9246 7.27999C61.4425 6.39171 63.2027 5.92007 65 5.92007C66.7972 5.92007 68.5575 6.39171 70.0754 7.27999L115.483 33.86C116.832 34.6495 117.944 35.7409 118.713 37.0329C119.483 38.3249 119.887 39.7755 119.887 41.25C119.887 42.7245 119.483 44.1751 118.713 45.4671C117.944 46.759 116.832 47.8505 115.483 48.64L70.0754 75.22C68.5575 76.1083 66.7972 76.5799 65 76.5799C63.2027 76.5799 61.4425 76.1083 59.9246 75.22L14.5167 48.64C13.1675 47.8505 12.0565 46.759 11.2866 45.4671C10.5167 44.1751 10.113 42.7245 10.113 41.25C10.113 39.7755 10.5167 38.3249 11.2866 37.0329C12.0565 35.7409 13.1675 34.6495 14.5167 33.86L59.9246 7.27999ZM65.7258 13.615C65.5088 13.4878 65.257 13.4203 65 13.4203C64.7429 13.4203 64.4912 13.4878 64.2742 13.615L18.8662 40.195C18.6738 40.3078 18.5154 40.4637 18.4057 40.6481C18.2959 40.8326 18.2384 41.0396 18.2384 41.25C18.2384 41.4604 18.2959 41.6674 18.4057 41.8519C18.5154 42.0363 18.6738 42.1921 18.8662 42.305L64.2742 68.885C64.4912 69.0122 64.7429 69.0797 65 69.0797C65.257 69.0797 65.5088 69.0122 65.7258 68.885L111.134 42.305C111.326 42.1921 111.485 42.0363 111.594 41.8519C111.704 41.6674 111.762 41.4604 111.762 41.25C111.762 41.0396 111.704 40.8326 111.594 40.6481C111.485 40.4637 111.326 40.3078 111.134 40.195L65.7258 13.615Z" fill="black"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M10.113 61.62C10.3985 61.204 10.7701 60.8441 11.2064 60.5606C11.6427 60.2772 12.1352 60.0759 12.6558 59.9682C13.1764 59.8605 13.7149 59.8485 14.2405 59.9329C14.7661 60.0172 15.2686 60.1964 15.7192 60.46L64.2742 88.885C64.4912 89.0122 64.743 89.0797 65 89.0797C65.2571 89.0797 65.5089 89.0122 65.7259 88.885L114.281 60.46C114.731 60.196 115.234 60.0166 115.76 59.9319C116.286 59.8472 116.824 59.859 117.345 59.9665C117.866 60.0739 118.359 60.2751 118.795 60.5584C119.232 60.8416 119.604 61.2015 119.89 61.6175C120.176 62.0335 120.37 62.4973 120.462 62.9827C120.554 63.468 120.541 63.9652 120.425 64.446C120.308 64.9268 120.09 65.3817 119.783 65.7847C119.476 66.1877 119.087 66.531 118.636 66.795L70.0755 95.22C68.5575 96.1083 66.7973 96.5799 65 96.5799C63.2028 96.5799 61.4426 96.1083 59.9246 95.22L11.3642 66.795C10.455 66.2618 9.81243 65.4171 9.57779 64.4466C9.34315 63.4762 9.53565 62.4595 10.113 61.62Z" fill="black"/>
                                    <path fillRule="evenodd" clipRule="evenodd" d="M10.113 81.62C10.3985 81.204 10.7701 80.8441 11.2064 80.5606C11.6427 80.2772 12.1352 80.0759 12.6558 79.9682C13.1764 79.8605 13.7149 79.8485 14.2405 79.9329C14.7661 80.0172 15.2686 80.1964 15.7192 80.46L64.2742 108.885C64.4912 109.012 64.743 109.08 65 109.08C65.2571 109.08 65.5089 109.012 65.7259 108.885L114.281 80.46C115.191 79.9269 116.293 79.7494 117.345 79.9665C118.397 80.1835 119.312 80.7774 119.89 81.6175C120.467 82.4576 120.66 83.475 120.425 84.446C120.189 85.4169 119.546 86.2619 118.636 86.795L70.0755 115.22C68.5575 116.108 66.7973 116.58 65 116.58C63.2028 116.58 61.4426 116.108 59.9246 115.22L11.3642 86.795C10.455 86.2618 9.81243 85.4171 9.57779 84.4467C9.34315 83.4762 9.53565 82.4595 10.113 81.62Z" fill="black"/>
                                    </svg>'
                                    judul='Course'
                                    value={course[0] === '' ? 0 : course.length}
                                    bordercolor={primary}
                                />
                                <Card
                                    svg='<svg width="110" height="110" viewBox="-15 -10 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M25 27.8571C23.6739 27.8571 22.4021 28.3463 21.4645 29.217C20.5268 30.0877 20 31.2686 20 32.5C20 33.7314 20.5268 34.9123 21.4645 35.783C22.4021 36.6537 23.6739 37.1429 25 37.1429V27.8571ZM45 37.1429C46.3261 37.1429 47.5979 36.6537 48.5355 35.783C49.4732 34.9123 50 33.7314 50 32.5C50 31.2686 49.4732 30.0877 48.5355 29.217C47.5979 28.3463 46.3261 27.8571 45 27.8571V37.1429ZM25 60.3571C23.6739 60.3571 22.4021 60.8463 21.4645 61.717C20.5268 62.5877 20 63.7686 20 65C20 66.2314 20.5268 67.4123 21.4645 68.283C22.4021 69.1537 23.6739 69.6429 25 69.6429V60.3571ZM85 69.6429C86.3261 69.6429 87.5979 69.1537 88.5355 68.283C89.4732 67.4123 90 66.2314 90 65C90 63.7686 89.4732 62.5877 88.5355 61.717C87.5979 60.8463 86.3261 60.3571 85 60.3571V69.6429ZM25 78.9286C23.6739 78.9286 22.4021 79.4177 21.4645 80.2884C20.5268 81.1591 20 82.3401 20 83.5714C20 84.8028 20.5268 85.9837 21.4645 86.8544C22.4021 87.7251 23.6739 88.2143 25 88.2143V78.9286ZM85 88.2143C86.3261 88.2143 87.5979 87.7251 88.5355 86.8544C89.4732 85.9837 90 84.8028 90 83.5714C90 82.3401 89.4732 81.1591 88.5355 80.2884C87.5979 79.4177 86.3261 78.9286 85 78.9286V88.2143ZM25 97.5C23.6739 97.5 22.4021 97.9892 21.4645 98.8599C20.5268 99.7306 20 100.911 20 102.143C20 103.374 20.5268 104.555 21.4645 105.426C22.4021 106.297 23.6739 106.786 25 106.786V97.5ZM45 106.786C46.3261 106.786 47.5979 106.297 48.5355 105.426C49.4732 104.555 50 103.374 50 102.143C50 100.911 49.4732 99.7306 48.5355 98.8599C47.5979 97.9892 46.3261 97.5 45 97.5V106.786ZM15 9.28571H95V0H15V9.28571ZM100 13.9286V116.071H110V13.9286H100ZM95 120.714H15V130H95V120.714ZM10 116.071V13.9286H0V116.071H10ZM15 120.714C13.6739 120.714 12.4021 120.225 11.4645 119.354C10.5268 118.484 10 117.303 10 116.071H0C0 119.766 1.58035 123.308 4.3934 125.92C7.20644 128.533 11.0218 130 15 130V120.714ZM100 116.071C100 117.303 99.4732 118.484 98.5355 119.354C97.5979 120.225 96.3261 120.714 95 120.714V130C98.9782 130 102.794 128.533 105.607 125.92C108.42 123.308 110 119.766 110 116.071H100ZM95 9.28571C96.3261 9.28571 97.5979 9.77487 98.5355 10.6456C99.4732 11.5163 100 12.6972 100 13.9286H110C110 10.2345 108.42 6.6917 105.607 4.07958C102.794 1.46747 98.9782 0 95 0V9.28571ZM15 0C11.0218 0 7.20644 1.46747 4.3934 4.07958C1.58035 6.6917 0 10.2345 0 13.9286H10C10 12.6972 10.5268 11.5163 11.4645 10.6456C12.4021 9.77487 13.6739 9.28571 15 9.28571V0ZM25 37.1429H45V27.8571H25V37.1429ZM25 69.6429H85V60.3571H25V69.6429ZM25 88.2143H85V78.9286H25V88.2143ZM25 106.786H45V97.5H25V106.786Z" fill="black"/>
                                    </svg>'
                                    judul='Materi'
                                    value={profil.materi_finished}
                                    bordercolor={magenta}
                                />
                                <Card
                                    svg='<svg width="110" height="110" viewBox="-5 -10 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M116.667 36.1111C116.667 33.2379 117.896 30.4824 120.084 28.4508C122.272 26.4191 125.239 25.2778 128.333 25.2778C131.428 25.2778 134.395 26.4191 136.583 28.4508C138.771 30.4824 140 33.2379 140 36.1111V109.428L128.333 125.678L116.667 109.428V36.1111ZM128.333 32.5C127.302 32.5 126.313 32.8805 125.583 33.5577C124.854 34.2349 124.444 35.1534 124.444 36.1111V107.239L128.333 112.656L132.222 107.239V36.1111C132.222 35.1534 131.812 34.2349 131.083 33.5577C130.354 32.8805 129.365 32.5 128.333 32.5Z" fill="black"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M136.111 50.5556H120.556V43.3333H136.111V50.5556ZM15.5556 7.22222C13.4928 7.22222 11.5145 7.98313 10.0558 9.33756C8.59722 10.692 7.77778 12.529 7.77778 14.4444V115.556C7.77778 117.471 8.59722 119.308 10.0558 120.662C11.5145 122.017 13.4928 122.778 15.5556 122.778H93.3333C95.3961 122.778 97.3744 122.017 98.8331 120.662C100.292 119.308 101.111 117.471 101.111 115.556V14.4444C101.111 12.529 100.292 10.692 98.8331 9.33756C97.3744 7.98313 95.3961 7.22222 93.3333 7.22222H15.5556ZM0 14.4444C0 10.6135 1.63888 6.93954 4.55612 4.23068C7.47335 1.52182 11.43 0 15.5556 0H93.3333C97.4589 0 101.416 1.52182 104.333 4.23068C107.25 6.93954 108.889 10.6135 108.889 14.4444V115.556C108.889 119.386 107.25 123.06 104.333 125.769C101.416 128.478 97.4589 130 93.3333 130H15.5556C11.43 130 7.47335 128.478 4.55612 125.769C1.63888 123.06 0 119.386 0 115.556V14.4444Z" fill="black"/>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M54.4444 32.5C54.4444 31.5423 54.8541 30.6238 55.5835 29.9466C56.3128 29.2693 57.3019 28.8889 58.3333 28.8889H89.4444C90.4758 28.8889 91.465 29.2693 92.1943 29.9466C92.9236 30.6238 93.3333 31.5423 93.3333 32.5C93.3333 33.4577 92.9236 34.3762 92.1943 35.0534C91.465 35.7307 90.4758 36.1111 89.4444 36.1111H58.3333C57.3019 36.1111 56.3128 35.7307 55.5835 35.0534C54.8541 34.3762 54.4444 33.4577 54.4444 32.5ZM54.4444 46.9444C54.4444 45.9867 54.8541 45.0682 55.5835 44.391C56.3128 43.7138 57.3019 43.3333 58.3333 43.3333H89.4444C90.4758 43.3333 91.465 43.7138 92.1943 44.391C92.9236 45.0682 93.3333 45.9867 93.3333 46.9444C93.3333 47.9022 92.9236 48.8207 92.1943 49.4979C91.465 50.1751 90.4758 50.5556 89.4444 50.5556H58.3333C57.3019 50.5556 56.3128 50.1751 55.5835 49.4979C54.8541 48.8207 54.4444 47.9022 54.4444 46.9444ZM54.4444 79.4445C54.4444 78.4867 54.8541 77.5682 55.5835 76.891C56.3128 76.2138 57.3019 75.8333 58.3333 75.8333H89.4444C90.4758 75.8333 91.465 76.2138 92.1943 76.891C92.9236 77.5682 93.3333 78.4867 93.3333 79.4445C93.3333 80.4022 92.9236 81.3207 92.1943 81.9979C91.465 82.6751 90.4758 83.0556 89.4444 83.0556H58.3333C57.3019 83.0556 56.3128 82.6751 55.5835 81.9979C54.8541 81.3207 54.4444 80.4022 54.4444 79.4445ZM54.4444 93.8889C54.4444 92.9312 54.8541 92.0127 55.5835 91.3354C56.3128 90.6582 57.3019 90.2778 58.3333 90.2778H89.4444C90.4758 90.2778 91.465 90.6582 92.1943 91.3354C92.9236 92.0127 93.3333 92.9312 93.3333 93.8889C93.3333 94.8466 92.9236 95.7651 92.1943 96.4423C91.465 97.1196 90.4758 97.5 89.4444 97.5H58.3333C57.3019 97.5 56.3128 97.1196 55.5835 96.4423C54.8541 95.7651 54.4444 94.8466 54.4444 93.8889ZM23.3333 79.4445V90.2778H35V79.4445H23.3333ZM19.4444 72.2222H38.8889C39.9203 72.2222 40.9094 72.6027 41.6387 73.2799C42.368 73.9571 42.7778 74.8756 42.7778 75.8333V93.8889C42.7778 94.8466 42.368 95.7651 41.6387 96.4423C40.9094 97.1196 39.9203 97.5 38.8889 97.5H19.4444C18.413 97.5 17.4239 97.1196 16.6946 96.4423C15.9653 95.7651 15.5555 94.8466 15.5555 93.8889V75.8333C15.5555 74.8756 15.9653 73.9571 16.6946 73.2799C17.4239 72.6027 18.413 72.2222 19.4444 72.2222ZM45.5272 29.9469C46.2563 30.6241 46.6658 31.5425 46.6658 32.5C46.6658 33.4575 46.2563 34.3759 45.5272 35.0531L27.2222 52.0506L16.695 42.2753C16.3236 41.9422 16.0273 41.5437 15.8235 41.1031C15.6197 40.6626 15.5124 40.1887 15.5079 39.7092C15.5034 39.2297 15.6018 38.7542 15.7973 38.3104C15.9929 37.8667 16.2816 37.4635 16.6468 37.1244C17.0119 36.7854 17.4461 36.5172 17.9241 36.3356C18.402 36.1541 18.9141 36.0627 19.4304 36.0669C19.9468 36.071 20.4571 36.1707 20.9316 36.3599C21.406 36.5492 21.8351 36.8243 22.1939 37.1692L27.2222 41.8383L40.0283 29.9469C40.7576 29.27 41.7466 28.8897 42.7778 28.8897C43.809 28.8897 44.7979 29.27 45.5272 29.9469Z" fill="black"/>
                                </svg>'
                                    judul='Exercise'
                                    value={profil.exercise_finished}
                                    bordercolor={yellow}
                                />
                                <Card
                                    svg='<svg width="110" height="110" viewBox="-25 -15 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M58.2534 53.9292L80 4.66666L58.2534 53.9292ZM29.3434 55.02L4.16669 4.66666L29.3434 55.02ZM49.4392 51.6133L26.5375 4.66666L49.4392 51.6133ZM58.7667 4.66666L52.7 19.25L58.7667 4.66666ZM10 86.3333C10 95.6159 13.6875 104.518 20.2513 111.082C26.8151 117.646 35.7174 121.333 45 121.333C54.2826 121.333 63.185 117.646 69.7488 111.082C76.3125 104.518 80 95.6159 80 86.3333C80 77.0507 76.3125 68.1484 69.7488 61.5846C63.185 55.0208 54.2826 51.3333 45 51.3333C35.7174 51.3333 26.8151 55.0208 20.2513 61.5846C13.6875 68.1484 10 77.0507 10 86.3333V86.3333Z" stroke="black" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>'
                                    judul='Badges'
                                    value={badges.length}
                                    bordercolor={black}
                                />
                                <Card
                                    svg='<svg width="110" height="110" viewBox="-15 -15 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M123.25 114.25H88.25V0.5H123.25V114.25ZM97 105.5H114.5V9.25H97V105.5ZM79.5 114.25H44.5V35.5H79.5V114.25ZM53.25 105.5H70.75V44.25H53.25V105.5ZM35.75 114.25H0.75V61.75H35.75V114.25ZM9.5 105.5H27V70.5H9.5V105.5Z" fill="black"/>
                            </svg>'
                                    judul='Level'
                                    value={profil.level_siswa}
                                    bordercolor={purple}
                                />
                                <Card
                                    svg='<svg width="110" height="110" viewBox="-15 -10 150 150" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M131.078 47.3241C130.451 45.3772 129.297 43.6419 127.744 42.3103C126.191 40.9787 124.3 40.1028 122.281 39.7794L90.5867 34.6287L75.8943 6.07797C74.9585 4.26039 73.54 2.73571 71.7946 1.67124C70.0493 0.606771 68.0444 0.0436401 66 0.0436401C63.9556 0.0436401 61.9508 0.606771 60.2054 1.67124C58.46 2.73571 57.0415 4.26039 56.1057 6.07797L41.4133 34.6287L9.72001 39.7794C7.70223 40.1078 5.8139 40.9857 4.2622 42.3167C2.71051 43.6477 1.55541 45.3804 0.923659 47.3247C0.291905 49.2689 0.207905 51.3496 0.680874 53.3385C1.15384 55.3274 2.16551 57.1476 3.60486 58.5993L26.2181 81.3952L21.3236 113.129C21.0095 115.15 21.259 117.219 22.0445 119.108C22.83 120.996 24.1212 122.632 25.776 123.834C27.4309 125.036 29.3852 125.759 31.4241 125.922C33.4631 126.086 35.5076 125.684 37.3328 124.761L66 110.298L94.668 124.761C96.4934 125.682 98.5374 126.082 100.576 125.918C102.614 125.754 104.567 125.031 106.221 123.829C107.876 122.627 109.167 120.993 109.953 119.105C110.739 117.218 110.989 115.15 110.677 113.129L105.783 81.3952L128.396 58.5993C129.84 57.1504 130.855 55.3302 131.328 53.3402C131.801 51.3502 131.715 49.268 131.078 47.3241ZM122.183 52.4374L96.461 78.3672L102.029 114.464C102.098 114.896 102.046 115.339 101.879 115.743C101.712 116.148 101.436 116.498 101.082 116.756C100.727 117.013 100.309 117.167 99.8724 117.201C99.436 117.235 98.9986 117.148 98.6088 116.949L66 100.498L33.391 116.949C33.0012 117.148 32.5638 117.236 32.1274 117.202C31.6909 117.168 31.2724 117.014 30.9182 116.756C30.5641 116.499 30.2881 116.149 30.1208 115.744C29.9535 115.339 29.9015 114.897 29.9705 114.464L35.5391 78.3672L9.81708 52.4371C9.50991 52.1268 9.29408 51.7379 9.19323 51.313C9.09238 50.8882 9.11041 50.4438 9.24533 50.0285C9.38026 49.6132 9.62688 49.2431 9.95817 48.9587C10.2895 48.6742 10.6927 48.4865 11.1236 48.4159L47.1738 42.5573L63.8861 10.0819C64.0859 9.69346 64.3889 9.36757 64.7618 9.14004C65.1348 8.91251 65.5632 8.79214 66 8.79214C66.4369 8.79214 66.8653 8.91251 67.2382 9.14004C67.6111 9.36757 67.9141 9.69346 68.114 10.0819L84.8262 42.5573L120.876 48.4159C121.307 48.4865 121.711 48.6742 122.042 48.9587C122.373 49.2431 122.62 49.6132 122.755 50.0285C122.89 50.4438 122.908 50.8882 122.807 51.313C122.706 51.7379 122.49 52.1268 122.183 52.4371L122.183 52.4374Z" fill="black"/>
                            </svg>'
                                    judul='Point'
                                    value={profil.point_siswa}
                                    bordercolor={green}
                                />
                            </div>
                        </div>
                    }
                </div>
                <div className='p-20-lr m-t-10 '>
                    <div className='text-center p-10-all badges-title'>
                        <h1>Badges</h1>
                    </div>
                    <div className='flex flex-wrap flex-center p-10-all badges-wrapper '>
                        {badges.length > 0 && badges.map(e => {
                            return (
                                <div className='text-center flex-only flex-column flex-center b-card' key={e.badge.id_badges}>
                                    <div className='flex flex-center'>
                                        <div dangerouslySetInnerHTML={{ __html: e.badge.badge_svg }} />
                                    </div>
                                    <div>
                                        <h2 className='caveat p-10-all'>{e.badge.nama_badges}</h2>
                                        <p className='p-10-all o-hide'>{e.badge.deskripsi_badges}</p>
                                    </div>
                                </div>
                            )
                        })}
                    </div>
                </div>
            </StyledWrapper>
        </StyledContainer>




    )
}